# <img src="https://github.com/user-attachments/assets/ce7446f7-7d6f-428a-b077-77d97e6eac81" width="28px"/> 한잔해

### 나만을 위한 AI 맞춤 전통주 큐레이션! -> [사이트 보러가기](https://hanjanhae.vercel.app/) 

![한잔해 이미지 1](https://github.com/user-attachments/assets/cd74aecc-c606-4260-83d4-f90d3a899262)

<br>

# 🍶 프로젝트 소개

- **서비스 기획 의도 :** <br>최근 전통주에 대한 관심이 높아지는 가운데,<br>
  사용자 취향에 따라 전통주를 추천하고 전통주와 어울리는 음식과의 페어링 정보를 제공함으로써<br>
  더 많은 사람들이 전통주의 매력을 느끼고 즐길 수 있도록 돕기 위해 기획되었습니다.
- **프로젝트 한 줄 설명 :** <br>사용자 취향에 따른 전통주 추천 및 음식과의 페어링, 전통주 관련 경험을 함께 제공하는 플랫폼.

<br>

# 👨‍👩‍👧‍👦 팀 소개

| **안현희** | **김현지** | **박가나** | **김호준** | **조혜빈** | **유지연** |
|:---:|:---:|:---:|:---:|:---:|:---:|
| <img src="https://cdn-static.zep.us/static/assets/baked-avartar-images/10-396-57-178.png" alt="안현희"> | <img src="https://cdn-static.zep.us/static/assets/baked-avartar-images/2-239-26-75.png" alt="김현지"> | <img src="https://cdn-static.zep.us/static/assets/baked-avartar-images/2-512-32-308.png" alt="박가나"> | <img src="https://cdn-static.zep.us/static/assets/baked-avartar-images/2-239-26-73.png" alt="김호준"> | <img src="https://cdn-static.zep.us/static/assets/baked-avartar-images/10-605-57-250.png" alt="조혜빈"> | <img src="https://cdn-static.zep.us/static/assets/baked-avartar-images/2-46-35-137.png" alt="유지연"> |
| **팀장** | **팀원** | **팀원** | **팀원** | **디자이너** | **디자이너** |
| [![Github Badge](https://img.shields.io/badge/GITHUB-181717?style=for-the-badge&logo=github&logoColor=white)](https://github.com/ahh0619/HANJANHAE)<br>[![Velog Badge](https://img.shields.io/badge/VELOG-20C997?style=for-the-badge&logo=velog&logoColor=white)](https://velog.io/@hhyun19/posts) | [![Github Badge](https://img.shields.io/badge/GITHUB-181717?style=for-the-badge&logo=github&logoColor=white)](https://github.com/hyeonjy)<br>[![Velog Badge](https://img.shields.io/badge/VELOG-20C997?style=for-the-badge&logo=velog&logoColor=white)](https://velog.io/@hg024246/posts) | [![Github Badge](https://img.shields.io/badge/GITHUB-181717?style=for-the-badge&logo=github&logoColor=white)](https://github.com/ParkGana)<br>[![Tistory Badge](https://img.shields.io/badge/TISTORY-F36C00?style=for-the-badge&logo=blogger&logoColor=white)](https://dev-gana.tistory.com/) | [![Github Badge](https://img.shields.io/badge/GITHUB-181717?style=for-the-badge&logo=github&logoColor=white)](https://github.com/minjun2131)<br>[![Velog Badge](https://img.shields.io/badge/VELOG-20C997?style=for-the-badge&logo=velog&logoColor=white)](https://velog.io/@minjun23221/posts) | @<br>@ | @<br>@ |

<br>

### 📋 [팀 노션 보러가기](https://www.notion.so/teamsparta/b-028a734a1008456eb3bac5078f586d1d)

<br>

<br>

# 📂 프로젝트 기능

### 🍀 주요 기능

### 1. OPEN AI Assistants 맞춤형 전통주 추천

- **취향 조사**를 통해 사용자별 선호도를 파악하고, 개인화된 전통주 추천 목록을 제공합니다.
    - 설문조사로 수집한 컨텍스트를 기반으로, 오픈AI 어시스턴스 툴과 API/레그(Leg) 시스템을 연동하여 개인화된 전통주 추천을 제공합니다. 이를 통해 사용자 취향을 정교하게 분석하고, 최적의 전통주를 정확하게 추천할 수 있습니다.
- 다양한 **테마별 전통주**를 추천해 드립니다.
    - 겨울에 어울리는 전통주, 단맛이 나는 전통주, 파전에 어울리는 전통주 등 다양한 테마로 전통주를 추천해 드립니다.
- **OPEN AI Assistants**
    - 오픈AI 어시스턴스 툴과 API·레그(Leg) 시스템을 연동하여, 사용자 취향을 정교하게 분석하고 최적의 전통주를 정확하게 추천해 드립니다. 설문조사나 검색 키워드 등으로 수집된 데이터를 바탕으로 이용자의 선호도를 세분화하고, 실시간으로 맞춤형 전통주를 안내해 드리는 것이 특징입니다.
    - **레그(Leg) 시스템**
        
        오픈AI 어시스턴스 툴과의 연동 과정에서, 데이터 처리와 분석 로직을 관리·연결하는 미들웨어 역할을 담당하는 시스템입니다.
        
        예컨대 설문조사나 검색 키워드 등 사용자 취향 정보를 입력받으면, 레그 시스템이 이를 적절히 전처리·분류한 뒤 오픈AI 어시스턴스로 전달합니다.
        
        이후 오픈AI 어시스턴스에서 응답받은 결과를 다시 레그 시스템이 취합·가공하여, 사용자가 쉽게 이해하고 활용할 수 있는 형태로 제공하게 됩니다.
        
        즉, “사용자 입력 → 레그 시스템 → 오픈AI 어시스턴스 → 레그 시스템 → 최종 사용자”의 흐름으로, 서비스 전반의 데이터 처리를 원활하게 돕는 중요한 연결고리라고 보시면 됩니다.
        

### 2. 전통주 및 다이닝바 상세 정보

- 전통주 카드를 클릭하면 **도수, 맛, 지역, 페어링** 등 세부 정보 확인이 가능합니다.
- 다이닝바 상세 페이지에서 **주소, 영업시간, 대표 메뉴** 등을 볼 수 있어, 전통주와 함께 즐길 수 있는 장소를 손쉽게 찾을 수 있습니다.

### 3. 좋아요

- 전통주에 **좋아요**를 누르고 취소하는 토글 형태 기능을 지원합니다.
- 좋아요 수를 바탕으로 한 인기 전통주 순위도 제공됩니다.
- **로그인하지 않은 상태**에서 좋아요를 누르면, 로그인 페이지로 안내해 편리한 서비스 이용을 돕습니다.

### 4. 검색 및 필터

- 원하는 전통주를 **키워드 검색**으로 빠르게 찾을 수 있습니다.
- **종류, 도수, 맛(단맛·신맛·청량감·바디감)** 등 다양한 조건별 필터를 제공해, 세밀하게 취향에 맞는 전통주를 탐색 가능합니다.

### 5. 마이페이지

- **프로필 이미지, 닉네임** 등의 회원 정보를 확인하고 수정할 수 있습니다.
- **내 취향 관리**를 통해 취향 설정을 추가·수정할 수 있습니다.
- **로그아웃** 및 **회원 탈퇴** 기능을 제공해 편리한 회원 관리가 가능합니다.

### 6. 리뷰 & 공유하기

- 전통주 상세 페이지에서 리뷰(내용, 별점)를 작성해 다른 사용자와 소통할 수 있습니다.
- **무한 스크롤** 형태로 리뷰를 볼 수 있어 편리하며, 내 리뷰는 수정·삭제가 가능합니다.
- **공유하기** 기능을 통해 카카오톡 등 다양한 채널로 손쉽게 콘텐츠를 공유할 수 있습니다.
<br>

<br>

### 🍀 부가 기능

### 푸시 알림 (PWA & FCM)

- **새 전통주가 등록**되면, 브라우저에서 **포그라운드·백그라운드 알림**이 실시간으로 도착합니다.
- 알림 클릭 시 **홈 페이지**로 이동해 확인할 수 있습니다.
- PWA 지원으로 **앱 설치 없이** 모바일 환경에서도 알림을 받아볼 수 있어, 최신 정보를 놓치지 않습니다.
- **Next PWA + Firebase Cloud Messaging(FCM)**
    
    ### 1. Next PWA
    
    1. **서버 사이드 렌더링(SSR) 및 정적 사이트 생성(SSG) 지원**
        - 검색 엔진 최적화(SEO)와 빠른 초기 로딩을 위해 SSR, SSG가 필수적이었습니다.
        - Next.js는 React 기반으로 SSR과 SSG를 쉽게 적용할 수 있어, 초기 페이지 로딩 속도와 SEO 효과를 극대화할 수 있습니다.
    2. **PWA 특성 구현**
        - 오프라인 지원, 홈 화면에 앱 설치, 웹 푸시 알림 등 사용자 경험을 개선하기 위해 PWA 기능을 도입했습니다.
        - Next.js는 서비스 워커(Workbox 등) 설정이나 매니페스트(Manifest) 파일 구성 등 PWA 관련 설정이 비교적 간편합니다.
    3. **개발 생산성 및 확장성**
        - 라우팅, 코드 스플리팅 등 Next.js가 제공하는 구조화된 개발 방식으로 대규모 프로젝트를 체계적으로 관리할 수 있습니다.
        - 커뮤니티와 생태계가 활발해, 에러나 기능 구현 시 참고 자료가 풍부합니다.
    
    ### 2. Firebase Cloud Messaging(FCM)
    
    1. **푸시 알림 기능 구현의 용이성**
        - 사용자에게 **실시간 알림**(전통주 신규 등록, 이벤트, 공지 등)을 전달하기 위해 푸시 메시징 기능이 필요했습니다.
        - FCM은 브라우저(웹)와 모바일(안드로이드/iOS) 모두 지원하며, 설정과 연동 과정이 비교적 간단해 빠르게 MVP를 구축할 수 있었습니다.
    2. **글로벌 인프라 및 신뢰도**
        - 구글 클라우드 기반 인프라를 사용하기 때문에 글로벌 서비스 운영에도 안정적입니다.
        - 대량의 메시지 트래픽 처리 경험이 풍부해, 스케일링 문제에 대한 부담이 적습니다.
    3. **다른 Firebase 서비스와의 연계 가능성**
        - 필요 시 Firebase Authentication, Cloud Functions 등 다른 Firebase 서비스를 손쉽게 연동할 수 있어 확장성이 높습니다.

<br>

# 📅 개발기간
### 2024. 12. 31. ~ 2025. 02. 06.

<br>

# ⚙️ 기술스택

<div>

  <!-- Language -->
  <h3>✔️ Language</h3>
  <img src="https://img.shields.io/badge/Typescript-3178C6?style=for-the-badge&logo=Typescript&logoColor=white" alt="TypeScript Badge">

  <!-- Framework & Libraries -->
  <h3>✔️ Framework & Libraries</h3>
  <img src="https://img.shields.io/badge/Next.js-000000?style=for-the-badge&logo=next.js&logoColor=white" alt="Next.js Badge">
  <img src="https://img.shields.io/badge/react-61DAFB?style=for-the-badge&logo=react&logoColor=white" alt="React Badge">
  <img src="https://img.shields.io/badge/Tanstack%20Query-FF4154?style=for-the-badge&logo=TanstackQuery&logoColor=white" alt="TanStack Query Badge">
  <img src="https://img.shields.io/badge/zustand-FF4154?style=for-the-badge&logo=TanstackQuery&logoColor=white" alt="Zustand Badge">
  <img src="https://img.shields.io/badge/tailwind%20css-06B6D4?style=for-the-badge&logo=tailwindcss&logoColor=white" alt="Tailwind CSS Badge">
  <br>
  <img src="https://img.shields.io/badge/supabase-3FCF8E?style=for-the-badge&logo=supabase&logoColor=white" alt="Supabase Badge">
  <img src="https://img.shields.io/badge/firebase-FFCA28?style=for-the-badge&logo=firebase&logoColor=white" alt="Firebase Badge">
  <img src="https://img.shields.io/badge/firebase%20admin-FFCA28?style=for-the-badge&logo=firebase&logoColor=white" alt="Firebase Admin Badge">
  <img src="https://img.shields.io/badge/Next%20PWA-000000?style=for-the-badge&logo=next.js&logoColor=white" alt="Next PWA Badge">

  <!-- Monitoring & Error Tracking -->
  <h3>✔️ Monitoring & Error Tracking</h3>
  <img src="https://img.shields.io/badge/Sentry-362D59?style=for-the-badge&logo=Sentry&logoColor=white" alt="Sentry Badge">

  <!-- Hosting & Deployment -->
  <h3>✔️ Hosting & Deployment</h3>
  <img src="https://img.shields.io/badge/Vercel-000000?style=for-the-badge&logo=vercel&logoColor=white" alt="Vercel Badge">

  <!-- Version Control -->
  <h3>✔️ Version Control</h3>
  <img src="https://img.shields.io/badge/git-F05032?style=for-the-badge&logo=git&logoColor=white" alt="Git Badge">
  <img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white" alt="GitHub Badge">

  <!-- API -->
  <h3>✔️ API</h3>
  <img src="https://img.shields.io/badge/kakaomap-FFCD00?style=for-the-badge&logo=kakao&logoColor=white" alt="KakaoMap Badge">
  <img src="https://img.shields.io/badge/OPEN%20AI%20Assistants-412991?style=for-the-badge&logo=OpenAI&logoColor=white" alt="OPEN AI Assistants Badge">

</div>
<br>

<br>

# 🚀 시스템 아키텍처

예정

<br>

<br>

# 🔖 ERD

![스크린샷 2025-02-06 144523](https://github.com/user-attachments/assets/1d8d561b-41d3-4df4-9ae0-5b27ebdcfc66)

<br>

<br>

# 📖 프로젝트 구조

```
📦 HANJANHAE
├─ ⚙️ .eslintrc.json
├─ ⚙️ .gitignore
├─ ⚙️ .prettierrc
├─ 📁 .vscode
│  └─ ⚙️ settings.json
├─ ⚙️ next.config.mjs
├─ ⚙️ package.json
├─ ⚙️ postcss.config.mjs
├─ 📁 public
│  ├─ 📁 assets
│  │  └─ 📁 icons
│  ├─ 📁 icons
│  ├─ 📄 service-worker.js
│  ├─ 📄 service-worker.js.map
│  ├─ 📄 workbox-1bb06f5e.js
│  └─ 📄 workbox-1bb06f5e.js.map
├─ 📄 README.md
├─ ⚙️ sentry.client.config.ts
├─ ⚙️ sentry.edge.config.ts
├─ ⚙️ sentry.server.config.ts
├─ 📁 src
│  ├─ 📁 app
│  │  ├─ 📁 actions
│  │  ├─ 📁 api
│  │  │  ├─ 📁 auth
│  │  │  │  ├─ 📁 signin
│  │  │  │  └─ 📁 social
│  │  │  ├─ 📁 drink
│  │  │  ├─ 📁 drinks
│  │  │  │  └─ 📁 new
│  │  │  ├─ 📁 recommend
│  │  │  └─ 📁 sentry-example-api
│  │  ├─ 📁 drink
│  │  │  ├─ 📁 [id]
│  │  │  │  ├─ 📄 error.tsx
│  │  │  │  └─ 📄 page.tsx
│  │  │  └─ 📁 _components
│  │  ├─ 📄 global-error.tsx
│  │  ├─ 📄 layout.tsx
│  │  ├─ 📁 like
│  │  │  ├─ 📄 page.tsx
│  │  │  └─ 📁 _components
│  │  ├─ 📄 manifest.ts
│  │  ├─ 📁 mypage
│  │  │  ├─ 📄 error.tsx
│  │  │  ├─ 📄 page.tsx
│  │  │  └─ 📁 _components
│  │  ├─ 📄 not-found.tsx
│  │  ├─ 📄 page.tsx
│  │  ├─ 📁 password
│  │  │  ├─ 📁 check
│  │  │  │  └─ 📄 page.tsx
│  │  │  ├─ 📁 reset
│  │  │  │  └─ 📄 page.tsx
│  │  │  └─ 📁 _components
│  │  ├─ 📁 place
│  │  │  ├─ 📁 [id]
│  │  │  │  ├─ 📄 error.tsx
│  │  │  │  └─ 📄 page.tsx
│  │  │  └─ 📁 _components
│  │  ├─ 📁 preferences
│  │  │  ├─ 📁 customization
│  │  │  │  ├─ 📄 error.tsx
│  │  │  │  ├─ 📄 page.tsx
│  │  │  │  └─ 📁 _components
│  │  │  └─ 📁 result
│  │  │     ├─ 📄 error.tsx
│  │  │     ├─ 📄 page.tsx
│  │  │     └─ 📁 _components
│  │  ├─ 📁 providers
│  │  ├─ 📄 providers.tsx
│  │  ├─ 📁 search
│  │  │  ├─ 📄 error.tsx
│  │  │  ├─ 📄 page.tsx
│  │  │  └─ 📁 _components
│  │  │     └─ 📁 _ui
│  │  ├─ 📁 sentry-example-page
│  │  │  └─ 📄 page.tsx
│  │  ├─ 📁 signin
│  │  │  ├─ 📄 page.tsx
│  │  │  └─ 📁 _components
│  │  ├─ 📁 signup
│  │  │  ├─ 📄 page.tsx
│  │  │  └─ 📁 _components
│  │  └─ 📁 survey
│  │     ├─ 📄 error.tsx
│  │     ├─ 📄 page.tsx
│  │     └─ 📁 _components
│  ├─ 📁 components
│  │  ├─ 📁 auth
│  │  ├─ 📁 common
│  │  ├─ 📁 home
│  │  └─ 📁 layout
│  ├─ 📁 constants
│  ├─ 📁 firebase
│  ├─ 📁 fonts
│  ├─ 📁 hooks
│  │  ├─ 📁 auth
│  │  ├─ 📁 common
│  │  ├─ 📁 like
│  │  ├─ 📁 mypage
│  │  ├─ 📁 preference
│  │  ├─ 📁 result
│  │  ├─ 📁 review
│  │  ├─ 📁 search
│  │  └─ 📁 survey
│  ├─ 📄 instrumentation.ts
│  ├─ 📁 lib
│  ├─ 📄 middleware.ts
│  ├─ 📁 store
│  ├─ 📁 styles
│  ├─ 📁 types
│  └─ 📁 utils
│     ├─ 📁 auth
│     ├─ 📁 common
│     ├─ 📁 drink
│     ├─ 📁 filter
│     ├─ 📁 recommend
│     ├─ 📁 review
│     ├─ 📁 share
│     └─ 📁 supabase
├─ ⚙️ tailwind.config.ts
├─ ⚙️ tsconfig.json
└─ 📄 yarn.lock
```

<br>

<br>

# 트러블 슈팅

<details>
<summary><b>로그인 성공 시 zustand에 유저 정보가 제대로 저장되지 않는 이슈</b></h4></summary>
<div markdown="1">

### **문제 발생**

로그인 성공 시 유저 정보를 zustand에 저장하고 이후 유저 정보가 필요할 때마다 매번 API를 호출하는 것이 아니라 zustand에 저장된 유저 정보를 가져와서 사용하도록 구현하였는데, 로그인을 성공했음에도 불구하고 유저 정보를 제대로 받아오지 못하고 새로고침을 해야 비로소 유저 정보를 받아오는 문제가 발생하였다.

### 원인 파악

```jsx
'use client';

import { createContext, useContext, useEffect, useState } from 'react';

import { useAuthStore } from '@/store/authStore';
import { SignInDataType } from '@/types/Auth';

import { fetchUser, signout } from '../actions/auth';

const AuthContext = createContext(null);

export const AuthProvider = ({ children }) => {
  const { user, setUser, removeUser } = useAuthStore();

  const [isAuthenticated, setIsAuthenticated] = useState(false);

  useEffect(() => {
    const fetchSignedUser = async () => {
      try {
        setUser(await fetchUser());
        setIsAuthenticated(true);
      } catch (error) {
        setUser(null);
        setIsAuthenticated(false);
      }
    };

    fetchSignedUser();
  }, [isAuthenticated]);

/* 로그인 */const login = async (values: SignInDataType) => {
    try {
      await signin();
      setIsAuthenticated(true);
    } catch (error) {
      throw error;
    }
  };

/* 로그아웃 */const logout = async () => {
    try {
      await signout();
      removeUser();
      setIsAuthenticated(false);
    } catch (error) {
      throw error;
    }
  };

  return (
    <AuthContext.Provider value={{ user, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => useContext(AuthContext);
```

```jsx
export const fetchUser = async (): Promise<UserType | null> => {
  const supabase = createClient();

  const {
    data: { user },
    error: authError,
  } = await supabase.auth.getUser();

  if (authError || !user) {
    return null;
  }

  const { data: userData, error: userError } = await supabase
    .from('users')
    .select('*')
    .eq('id', user.id)
    .single();

  if (userError || !userData) {
    throw new Error(userError.message || '유저 정보를 가져올 수 없습니다.');
  }

  return {
    id: userData.id,
    nickname: userData.nickname,
    profile_image: userData.profile_image || null,
    agree_terms: userData.agree_terms,
  };
};
```

기존 코드를 살펴보면 다음 3가지 동작이 발생할 때마다 fetchUser()의 결과값을 zustand의 user에 반영해주고 있다.

- 서비스에 처음 접속했을 때
- 화면이 새로고침 됐을 때
- isAuthenticated 값이 변경될 때

코드에는 문제가 없는 것 같은데 왜 원하는대로 동작을 안하지? 라는 생각을 하면서 fetchUser() 코드를 살펴보는 순간 원인을 알게 되었다. fetchUser() 코드를 살펴보면 getUser()에서 오류가 발생하거나 user 데이터를 반환해주지 않는 경우 에러가 아닌 null 값을 반환하고 있다.

즉, fetchUser()가 null을 반환하게 되면 에러가 나는 상황이 아니기 때문에 isAuthenticated에 true를 적용해주게 되고, 그렇게 되면 로그인을 성공해도 isAuthenticated가 이미 true이기 때문에 useEffect가 실행되지 않아서 setUser()가 실행되지 않게 되는 것이다.

### 해결

```jsx
useEffect(() => {
    const fetchSignedUser = async () => {
        try {
            const currentUser = await fetchUser();
            setUser(currentUser);
            setIsAuthenticated(!!currentUser);
        } catch (error) {
            setUser(null);
            setIsAuthenticated(false);
        }
    };

    fetchSignedUser();
}, [isAuthenticated]);
```

최종적으로, 단순히 fetchUser()에서 에러가 발생하지 않는다고 무조건 isAuthenticated를 true로 적용하는 것이 아니라 반환값에 따라 적용해줌으로써 문제를 해결할 수 있었다.

<br>
</div>
</details>



